---
import { Image } from "astro:assets";
import type { ImageAsset } from "../../provider/imageProvider";
import { getImageAlt } from "../../provider/imageProvider";
import { getLangFromUrl } from "../../i18n/utils";

const lang = getLangFromUrl(Astro.url);

/**
 * Single item in the list. Supports text-only or logo+link variants.
 */
interface ItemListItem {
  /**
   * Item description text.
   */
  description: string;
  /**
   * Optional URL (when set, renders as link instead of static card).
   */
  href?: string;
  /**
   * Optional logo image (when set, renders logo above title).
   */
  image?: ImageAsset;
  /**
   * Item title/heading.
   */
  title: string;
}

interface Props {
  /**
   * Optional badge text above the section title.
   */
  badge?: string;
  /**
   * Number of columns: 1, 2, or 3. Default: 2.
   */
  columns?: 1 | 2 | 3;
  /**
   * Optional description paragraph under the section title.
   */
  description?: string;
  /**
   * List of items to display.
   */
  items: ItemListItem[];
  /**
   * Color theme: light (white), dark, or grey.
   */
  theme?: "light" | "dark" | "grey";
  /**
   * Optional section heading.
   */
  title?: string;
}

const { badge, columns = 2, description, items, theme = "light", title } = Astro.props;

const isDark = theme === "dark";
const isGrey = theme === "grey";
const hasItems = items.length > 0;

const sectionBgClass = isDark
  ? "bg-dark-bg"
  : isGrey
    ? "bg-slate-100"
    : "bg-white";

const titleClass = isDark ? "text-white" : "text-dark";
const itemTitleClass = isDark ? "text-white" : "text-dark";
const itemDescClass = isDark ? "text-white/80" : "text-dark/70";
const descClass = isDark ? "text-white/80" : "text-dark/70";

const cardBgClass = isDark
  ? "bg-white/5"
  : isGrey
    ? "bg-white"
    : "bg-slate-100";

const linkCardClass = isDark
  ? "bg-white/5 hover:bg-white/10"
  : "bg-slate-100 hover:bg-slate-200";

const gridColsClass =
  columns === 1
    ? "grid-cols-1"
    : columns === 2
      ? "sm:grid-cols-2"
      : "sm:grid-cols-2 lg:grid-cols-3";
---

{
  hasItems && (
    <section class:list={["relative overflow-hidden", sectionBgClass]}>
      {/* ItemList: optional header + grid of items (text cards or logo+link cards) */}
      <div class="mx-auto max-w-8xl px-6 py-12 md:px-12 md:py-20 lg:px-16 lg:py-24">
        {/* Section header: badge, title, description (all optional) */}
        {(badge || title || description) && (
          <div class="fade-in-section mb-8 max-w-4xl md:mb-12">
            {badge && (
              <div class="mb-4 inline-block rounded-tl-xl rounded-br-xl bg-gradient-to-r from-primary to-primary-light px-3 py-1 md:mb-6">
                <h3 class="font-outfit text-sm uppercase tracking-wider text-white leading-[1.3] md:text-base">
                  {badge}
                </h3>
              </div>
            )}
            {title && (
              <h2
                class:list={[
                  "font-anton text-3xl leading-tight md:text-4xl lg:text-5xl",
                  titleClass,
                ]}
              >
                {title}
              </h2>
            )}
            {description && (
              <p
                class:list={[
                  "mt-1 text-base font-light leading-relaxed md:text-lg",
                  descClass,
                ]}
              >
                {description}
              </p>
            )}
          </div>
        )}

        {/* Items grid: cards with title + description (link or static) */}

        <div class:list={["fade-in-section delay-200 grid gap-6 md:gap-6", gridColsClass]}>
          {items.map((item) => {
            const isLink = !!item.href;
            const hasImage = !!item.image;

            /* Card content: optional logo, title, description */
            const cardContent = (
              <>
                {hasImage && (
                  <div class="mb-4 flex h-16 items-center md:h-20">
                    <Image
                      src={item.image!.src as import("astro").ImageMetadata}
                      alt={getImageAlt(item.image!, lang)}
                      class="h-full w-auto max-w-32 object-contain object-left opacity-90 transition-opacity duration-300 group-hover:opacity-100"
                      width={160}
                      height={80}
                    />
                  </div>
                )}
                <h3
                  class:list={[
                    hasImage ? "mb-2 font-anton text-xl leading-tight md:text-2xl" : "mb-3 font-outfit text-lg font-semibold md:text-xl",
                    itemTitleClass,
                  ]}
                >
                  {item.title}
                </h3>
                <p
                  class:list={[
                    hasImage ? "flex-1 text-sm leading-relaxed md:text-base" : "font-outfit text-base leading-relaxed md:text-lg",
                    itemDescClass,
                  ]}
                >
                  {item.description}
                </p>
              </>
            );

            if (isLink) {
              return (
                <a
                  href={item.href}
                  target="_blank"
                  rel="noopener noreferrer"
                  class:list={[
                    "item-list-card group flex flex-col rounded-br-4xl overflow-hidden p-6",
                    linkCardClass,
                  ]}
                >
                  {cardContent}
                </a>
              );
            }

            return (
              <article
                class:list={[
                  "item-list-card flex flex-col rounded-br-4xl p-6 md:p-8",
                  cardBgClass,
                ]}
              >
                {cardContent}
              </article>
            );
          })}
        </div>
      </div>
    </section>
  )
}

<style>
  .item-list-card {
    transition: transform 0.3s ease-out;
  }
  .item-list-card:hover {
    transform: translateY(-4px);
  }
</style>
