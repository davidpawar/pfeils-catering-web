---
import { Image } from "astro:assets";
import type { ImageAsset } from "../../provider/imageProvider";
import { getImageAlt } from "../../provider/imageProvider";
import { getLangFromUrl } from "../../i18n/utils";

const lang = getLangFromUrl(Astro.url);

interface GalleryItem {
  image: ImageAsset;
}

interface Props {
  /**
   * Optional badge text above the section heading.
   */
  badgeText?: string;
  /**
   * List of gallery items (each with an image).
   */
  items: GalleryItem[];
  /**
   * Optional description paragraph under the section heading.
   */
  sectionDescription?: string;
  /**
   * Optional section heading.
   */
  sectionTitle?: string;
}

const { badgeText, items, sectionDescription, sectionTitle } = Astro.props;

// Varying aspect ratios for true masonry stagger (square, landscape, portrait, wide)
const aspectRatios = ["aspect-square", "aspect-video", "aspect-[3/4]", "aspect-[4/3]"];
---

{/* ImageGalleryMasonry: masonry grid of images with optional header */}
<section class="bg-slate-100">
  <div class="mx-auto max-w-8xl px-6 py-12 md:px-12 md:py-20 lg:px-16 lg:py-24">
    {/* Section header: badge, title, description (optional) */}
    {(badgeText || sectionTitle || sectionDescription) && (
      <div class="fade-in-section mb-6 max-w-4xl md:mb-8">
        {badgeText && (
          <div
            class="mb-4 inline-block rounded-tl-xl rounded-br-xl bg-gradient-to-r from-primary to-primary-light px-3 py-1 md:mb-6"
          >
            <h3
              class="font-outfit text-sm uppercase tracking-wider text-white leading-[1.3] md:text-base"
            >
              {badgeText}
            </h3>
          </div>
        )}
        {sectionTitle && (
          <h2 class="mb-1 font-anton text-3xl leading-tight text-dark md:text-4xl lg:text-5xl">
            {sectionTitle}
          </h2>
        )}
        {sectionDescription && (
          <p class="text-base font-light leading-relaxed text-dark/70 md:text-lg">
            {sectionDescription}
          </p>
        )}
      </div>
    )}

    {/* Masonry grid: responsive columns with varying aspect ratios */}
    <div class="masonry-gallery fade-in-section delay-200">
      {items.map((item, i) => {
        const aspectClass = aspectRatios[i % aspectRatios.length];
        return (
          <article class="group masonry-card flex flex-col overflow-hidden rounded-br-4xl bg-white p-0 transition-shadow duration-300 hover:shadow-lg">
            {/* Gallery card: image with hover zoom */}
            <div class={`overflow-hidden rounded-br-4xl ${aspectClass}`}>
              <Image
                src={item.image.src as import("astro").ImageMetadata}
                alt={getImageAlt(item.image, lang)}
                class="h-full w-full object-cover transition-transform duration-500 ease-out group-hover:scale-110"
                width={600}
                height={600}
              />
            </div>
          </article>
        );
      })}
    </div>
  </div>
</section>

<style>
  .masonry-gallery {
    column-count: 1;
    column-gap: 1.5rem;
  }
  .masonry-card {
    break-inside: avoid;
    margin-bottom: 1.5rem;
  }
  @media (min-width: 768px) {
    .masonry-gallery {
      column-count: 2;
    }
  }
</style>
