---
import { Image } from "astro:assets";
import Button from "../ui/Button.astro";
import type { ImageAsset } from "../../provider/imageProvider";
import { getImageAlt } from "../../provider/imageProvider";
import { getLangFromUrl } from "../../i18n/utils";

const lang = getLangFromUrl(Astro.url);

interface Props {
  /**
   * Small badge headline shown above the main title.
   */
  badgeText: string;
  /**
   * Optional button label when link is set. Default: "Mehr erfahren".
   */
  buttonText?: string;
  /**
   * Optional list of check items shown below the description in a 2-column layout.
   */
  checkItems?: string[];
  /**
   * Optional supporting paragraph below the heading (plain text).
   */
  description?: string;
  /**
   * Optional HTML content for the description. When set, overrides description.
   * Supports <p>, <strong>, etc. from the source page.
   */
  descriptionHtml?: string;
  /**
   * Image with src and alt from central registry.
   */
  image: ImageAsset;
  /**
   * Image aspect: "standard" (4:3, object-cover) or "original" (portrait 3:4, object-contain).
   * Use "original" for cocktail/portrait images to avoid cropping.
   */
  imageAspect?: "standard" | "original";
  /**
   * Position of the image: "left" (default) or "right".
   */
  imagePosition?: "left" | "right";
  /**
   * Optional URL for the CTA button. When set, a button is shown at the bottom.
   */
  link?: string;
  /**
   * Description text for the left statistic.
   */
  leftStatLabel?: string;
  /**
   * Prefix label for the left statistic, e.g. "seit".
   */
  leftStatPrefix?: string;
  /**
   * Numeric/value part of the left statistic.
   */
  leftStatValue?: string;
  /**
   * Description text for the right statistic.
   */
  rightStatLabel?: string;
  /**
   * Numeric/value part of the right statistic.
   */
  rightStatValue?: string;
  /**
   * Main heading text of the content area.
   */
  title: string;
  /**
   * Visual theme: "light" (default), "dark", or "grey".
   * Dark uses bg-dark-bg with white text. Grey uses bg-slate-100, text like light.
   */
  theme?: "light" | "dark" | "grey";
}

const {
  badgeText,
  buttonText = "Mehr erfahren",
  checkItems = [],
  description = "",
  descriptionHtml,
  image,
  imageAspect = "standard",
  imagePosition = "left",
  leftStatLabel,
  leftStatPrefix = "",
  leftStatValue,
  link,
  rightStatLabel,
  rightStatValue,
  theme = "light",
  title,
} = Astro.props;

const showStats =
  leftStatLabel != null &&
  leftStatValue != null &&
  rightStatLabel != null &&
  rightStatValue != null;

const isDark = theme === "dark";
const isImageRight = imagePosition === "right";

const flexOrderClasses = isImageRight
  ? "flex-col-reverse md:flex-row-reverse"
  : "flex-col md:flex-row";
const titleClass = isDark ? "text-white" : "text-dark";
const descriptionClass = isDark ? "text-white/90" : "text-dark/70";
const statValueClass = isDark ? "text-primary-light" : "text-primary";
const statLabelClass = isDark ? "text-white/90" : "text-dark/70";
const checkTextClass = isDark ? "text-white/90" : "text-dark/70";
const checkIconClass = isDark ? "text-primary-light" : "text-primary";
---

{/* ImageText: Section with image + text content (badge, title, description, check list, optional stats/button) */}
<section
  class:list={[
    "relative max-w-full",
    isDark && "bg-dark-bg",
    theme === "grey" && "bg-slate-100",
  ]}
>
  <div
    class:list={[
      "mx-auto flex max-w-8xl gap-8 px-6 py-12 md:gap-12 md:px-12 md:py-20 lg:gap-20 lg:px-16 lg:py-28",
      flexOrderClasses,
    ]}
  >
    {/* Image block: left or right depending on imagePosition */}
    <div
      class="fade-in-section flex w-full justify-center md:w-1/2 md:justify-end"
    >
      <div
        class:list={[
          "w-full overflow-hidden rounded-br-4xl",
          imageAspect === "original"
            ? "aspect-[3/4] md:aspect-[3/4]"
            : "aspect-[4/3] md:aspect-square",
        ]}
      >
        <Image
          src={image.src as import("astro").ImageMetadata}
          alt={getImageAlt(image, lang)}
          class:list={[
            "h-full w-full",
            imageAspect === "original" ? "object-contain" : "object-cover",
          ]}
          width={imageAspect === "original" ? 600 : 800}
          height={imageAspect === "original" ? 800 : 600}
        />
      </div>
    </div>

    {/* Content block: badge, title, description, check list, stats, button */}
    <div
      class="fade-in-section delay-200 flex flex-1 flex-col justify-center gap-4 md:gap-6"
    >
      {/* Badge: small label above title */}
      <div>
        <div
          class="mb-2 inline-block rounded-tl-xl rounded-br-xl bg-gradient-to-r from-primary to-primary-light px-3 py-1"
        >
          <h2
            class="font-outfit text-sm uppercase tracking-wider text-white leading-[1.3] md:text-base"
          >
            {badgeText}
          </h2>
        </div>
      </div>

      {/* Title: main heading */}
      <div>
        <p
          class:list={[
            "font-anton text-3xl leading-tight md:text-4xl lg:text-5xl",
            titleClass,
          ]}
        >
          {title}
        </p>
      </div>

      {/* Description (optional): HTML or plain text */}
      {descriptionHtml ? (
        <div
          class:list={[
            "image-text-description text-base font-light leading-relaxed md:text-lg max-w-none",
            descriptionClass,
          ]}
          set:html={descriptionHtml}
        />
      ) : description ? (
        <div>
          <p
            class:list={[
              "text-base font-light leading-relaxed md:text-lg",
              descriptionClass,
            ]}
          >
            {description}
          </p>
        </div>
      ) : null}

      {/* Check list: 2-column grid of checkmark items (optional) */}
      {
        checkItems.length > 0 && (
          <div class="grid grid-cols-2 gap-x-4 gap-y-2 sm:gap-x-6 sm:gap-y-3">
            {checkItems.map((item) => (
              <div class="flex items-center gap-2">
                <svg
                  class:list={["h-5 w-5 shrink-0", checkIconClass]}
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true"
                >
                  <path d="M5 13l4 4L19 7" />
                </svg>
                <span
                  class:list={[
                    "font-outfit text-sm md:text-base",
                    checkTextClass,
                  ]}
                >
                  {item}
                </span>
              </div>
            ))}
          </div>
        )
      }

      {/* Statistics: left/right stat blocks (optional) */}
      {
        showStats && (
          <div class="mt-2 grid grid-cols-2 gap-6 md:gap-10">
            <div class="flex flex-col gap-2 md:gap-3">
              <div class="flex items-center gap-1">
                <div
                  class:list={[
                    "font-outfit text-lg md:text-2xl",
                    statValueClass,
                  ]}
                >
                  {leftStatPrefix}
                </div>
                <div
                  class:list={[
                    "font-outfit text-4xl font-semibold tracking-wide leading-none md:text-5xl lg:text-6xl",
                    statValueClass,
                  ]}
                >
                  {leftStatValue}
                </div>
              </div>
              <p
                class:list={[
                  "font-outfit text-base md:text-xl",
                  statLabelClass,
                ]}
              >
                {leftStatLabel}
              </p>
            </div>

            <div class="flex flex-col gap-2 md:gap-3">
              <div
                class:list={[
                  "font-outfit text-4xl font-semibold tracking-wide leading-none md:text-5xl lg:text-6xl",
                  statValueClass,
                ]}
              >
                {rightStatValue}
              </div>
              <p
                class:list={[
                  "font-outfit text-base md:text-xl",
                  statLabelClass,
                ]}
              >
                {rightStatLabel}
              </p>
            </div>
          </div>
        )
      }

      {/* Button: CTA link (optional, shown when link prop is set) */}
      {
        link && (
          <Button href={link} class="mt-6 md:mt-8">
            {buttonText}
          </Button>
        )
      }
    </div>
  </div>
</section>
