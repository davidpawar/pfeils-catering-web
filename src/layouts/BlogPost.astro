---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/base/BaseHead.astro";
import Footer from "../components/base/Footer.astro";
import Navigation from "../components/base/Navigation.astro";
import {
  getLangFromUrl,
  useTranslations,
  useTranslatedPath,
} from "../i18n/utils";
import type { ui } from "../i18n/translations";

type Props = (CollectionEntry<"blogDe"> | CollectionEntry<"blogEn">)["data"] & {
  lang?: keyof typeof ui;
};

const {
  title,
  description,
  author,
  pubDate,
  updatedDate,
  heroImage,
  lang: langProp,
} = Astro.props;
const lang: keyof typeof ui = langProp ?? getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const heroUrl = heroImage ?? "/blog-placeholder-3.jpg";

function formatDate(date: Date, locale: string): string {
  return new Intl.DateTimeFormat(locale, {
    day: "numeric",
    month: "long",
    year: "numeric",
  }).format(date);
}
---

<style is:global>
  .blog-content > p:has(> img) {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    justify-content: center;
    margin: 0 0 2rem 0;
  }
  .blog-content > p:has(> img) img {
    flex: 1 1 280px;
    min-width: 0;
    max-width: 100%;
    margin-top: 0;
    margin-bottom: 0;
  }
</style>

<!doctype html>
<html lang={lang}>
  <head>
    <BaseHead title={title} description={description} lang={lang} />
  </head>
  <body>
    <div class="relative">
      <Navigation />
      <main>
        {/* Hero: article title with background image */}
        <section
          class="relative flex min-h-[45vh] flex-col justify-center bg-dark-bg bg-cover bg-center bg-no-repeat md:min-h-[30vh]"
          style={{
            backgroundImage: `url('${heroUrl}')`,
          }}
        >
          <div
            class="absolute inset-0 bg-gradient-to-r from-black/67 to-black/32 opacity-75"
          >
          </div>
        </section>

        {/* Article content */}
        <article class="bg-white">
          <div
            class="mx-auto max-w-6xl px-6 py-12 md:px-12 md:py-16 lg:px-16 lg:py-20 min-[1920px]:max-w-7xl"
          >
            <div class="w-full">
              {/* Meta: Zurück-Link, Titel, Autor, Datum */}
              <header class="border-b border-slate-300 pb-8">
                <a
                  href={translatePath("/blog/")}
                  class="group mb-4 inline-flex items-center gap-2 rounded-full border border-primary/30 bg-primary/5 px-4 py-2 font-outfit text-sm font-medium text-primary transition-all hover:border-primary hover:bg-primary hover:text-white"
                >
                  <span class="transition-transform group-hover:-translate-x-0.5" aria-hidden="true">←</span>
                  {t("blog.backToBlog")}
                </a>
                <h1
                  class="font-anton text-2xl leading-tight text-dark md:text-3xl lg:text-4xl"
                >
                  {title}
                </h1>
                <div
                  class="mt-3 flex flex-wrap items-center gap-x-4 gap-y-1 font-outfit text-sm text-dark/60"
                >
                  <span>{author ?? t("blog.defaultAuthor")}</span>
                  <span class="text-dark/40" aria-hidden="true">·</span>
                  <time datetime={pubDate.toISOString()}>
                    {formatDate(pubDate, lang === "en" ? "en-GB" : "de-DE")}
                  </time>
                </div>
              </header>

              {/* Artikelinhalt */}
              <div
                class="blog-content pt-8 font-outfit text-base leading-relaxed text-dark/85 md:text-lg [&_a]:text-primary [&_a]:underline [&_a]:underline-offset-2 [&_a:hover]:text-primary-light [&_h2]:font-anton [&_h2]:mt-12 [&_h2]:mb-4 [&_h2]:text-2xl [&_h2]:md:text-3xl [&_h2]:text-dark [&_h3]:font-anton [&_h3]:mt-8 [&_h3]:text-xl [&_h3]:text-dark [&_p]:mb-4 [&_ul]:mb-4 [&_ul]:list-disc [&_ul]:pl-6 [&_ol]:mb-4 [&_ol]:list-decimal [&_ol]:pl-6 [&_pre]:mb-4 [&_pre]:overflow-x-auto [&_pre]:rounded-lg [&_pre]:bg-slate-100 [&_pre]:p-4 [&_code]:rounded [&_code]:bg-slate-100 [&_code]:px-1.5 [&_code]:py-0.5 [&_code]:font-mono [&_code]:text-sm [&_img]:my-8 [&_img]:block [&_img]:w-full [&_img]:max-w-2xl [&_img]:mx-auto [&_img]:rounded-xl [&_img]:shadow-lg [&_img]:object-cover"
              >
                <slot />
              </div>
            </div>
          </div>
        </article>
      </main>
      <Footer />
    </div>
  </body>
</html>
